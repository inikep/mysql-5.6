--disable_warnings
--source include/not_valgrind.inc
--source include/have_rocksdb.inc
--source include/have_binlog_format_row.inc
--enable_warnings

--disable_query_log
call mtr.add_suppression("Column family.*not found");
call mtr.add_suppression("Cannot mark Column family.*to be dropped");
call mtr.add_suppression("Could not get index information for Index Number");
--enable_query_log

--let $num_workers = 4
--let $num_requests = 1000

CREATE USER 'drop_cf_test'@'localhost' IDENTIFIED WITH 'mysql_native_password';
GRANT ALL ON *.* TO 'drop_cf_test'@'localhost';

connect (conn1,localhost,drop_cf_test,,);
--connection conn1

--let $local_host = 127.0.0.1

let $exec =
  /usr/bin/python3 $MYSQL_TEST_DIR/suite/rocksdb_stress/t/alter_table_crash.py
  -L $MYSQL_TMP_DIR/alter_table_crash.log -H $local_host
  -P $MASTER_MYPORT
  -w $num_workers -r $num_requests -v -u drop_cf_test;

exec $exec;

--exec rm $MYSQL_TMP_DIR/alter_table_crash.log

DROP USER 'drop_cf_test'@'localhost';
